extends layout

block content
    div#video-content
        div#player-container
            div#player

    script(src='../javascripts/jquery-3.3.1.min.js')
    script(src='../javascripts/helpers.js')
    
    script.
        $(function() {
            var lightsOff = function() {
                $("nav").css({opacity: 0}, 1000);
                $("body").animate({backgroundColor: "black"});
            },
            lightsOn = function() {
                $("nav").animate({opacity: 1}, 1000);
                $("body").animate({backgroundColor: "white"});
            };
            
            lightsOff();
            
            var getPlayerVars = function(videoId) {
                var playerVars = {};
                switch (videoId) {
                    case '9Koln22mx6c':
                        playerVars.autoplay = 1;
                        playerVars.start = 65;
                        playerVars.end = 70;
                        break;
                    default:
                        playerVars.start = '#{playerData.video_start}',
                        playerVars.end = '#{playerData.video_end}',
                        playerVars.autoplay = '#{playerData.autoplay}'
                }
                return playerVars;
            }; 
            
            TazGHelpers.whenYoutubeApiReady(function() {
                var player;
                var handlers = {};
                
                handlers[YT.PlayerState.ENDED] = lightsOn;
                handlers[YT.PlayerState.PAUSED] = lightsOn;
                handlers[YT.PlayerState.PLAYING] = lightsOff;

                /*var timeoutQueued = false;
                handlers[YT.PlayerState.PLAYING] = function() {
                    if (!timeoutQueued && player.getVideoData().video_id == 'HKK4KmDlj8U') {
                        setTimeout(function() {
                            $("#player-container").animate({opacity: 0}, 500);
                            timeoutQueued = true;
                        }, 8600);
                    }
                    $("#player-container").animate({opacity: 1}, 250);
                    console.log("playing");
                };     
                */
                TazGHelpers.addYTPlayer("player", {
                    videoId: '#{playerData.video_id}',
                    playerVars: getPlayerVars('#{playerData.video_id}')
                }, 
                function(p) {
                    player = p;
                    TazGHelpers.addYTPlayerStateHandlers(player, handlers);
                    console.log(player);
                });
            });
        });